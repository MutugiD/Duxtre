#this is the client file
from azure.core.credentials import AzureKeyCredential
from azure.search.documents import SearchClient
from azure.search.documents.indexes import SearchIndexClient
from azure.search.documents.indexes.models import (
    SearchIndex,
    SearchField,
    SearchFieldDataType,
    SimpleField,
    SearchableField,
    ComplexField,
    VectorSearch,
    VectorSearchProfile,
    HnswAlgorithmConfiguration,
)
from loguru import logger

from src.core.settings import settings


def get_search_index_client():
    """
    Get a search index client for Azure AI Search
    """
    return SearchIndexClient(
        endpoint=settings.azure_search_endpoint,
        credential=AzureKeyCredential(settings.azure_search_key),
    )


def get_search_client(index_name: str):
    """
    Get a search client for Azure AI Search
    """
    return SearchClient(
        endpoint=settings.azure_search_endpoint,
        index_name=index_name,
        credential=AzureKeyCredential(settings.azure_search_key),
    )


def create_property_records_index(force_recreate=False):
    """
    Create the property records index in Azure AI Search if it doesn't exist
    or recreate it if force_recreate is True

    Args:
        force_recreate: If True, delete the existing index and recreate it
    """
    try:
        index_client = get_search_index_client()

        # Check if index exists
        if settings.azure_property_index in [
            index.name for index in index_client.list_indexes()
        ]:
            if force_recreate:
                logger.info(
                    f"Deleting existing index {settings.azure_property_index} to recreate it"
                )
                index_client.delete_index(settings.azure_property_index)
            else:
                logger.info(
                    f"Index {settings.azure_property_index} already exists"
                )
                return

        # Define vector search configuration
        vector_search = VectorSearch(
            algorithms=[
                HnswAlgorithmConfiguration(
                    name="hnsw-config",
                    parameters={
                        "m": 4,
                        "efConstruction": 400,
                        "efSearch": 500,
                        "metric": "cosine",
                    },
                )
            ],
            profiles=[
                VectorSearchProfile(
                    name="embedding-profile",
                    algorithm_configuration_name="hnsw-config",
                )
            ],
        )

        # Define fields for the property index based on exact specifications
        fields = [
            # Key field - id (non-searchable, non-filterable, retrievable, stored, non-sortable, non-facetable, key=true)
            SimpleField(
                name="id",
                type=SearchFieldDataType.String,
                key=True,
                searchable=False,
                filterable=False,
                retrievable=True,
                stored=True,
                sortable=False,
                facetable=False
            ),

            # Basic fields with exact specifications
            SearchableField(
                name="ConfigurationId",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="TeamName",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="TeamURL",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="Address",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="Address2",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="City",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="State",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="ZipCode",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="Country",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="Latitude",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="Longitude",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="ListingName",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="PropertyStage",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="PropertyStatus",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SimpleField(
                name="IsFeatureListing",
                type=SearchFieldDataType.Boolean,
                searchable=False,
                filterable=True,
                retrievable=True,
                stored=True,
                sortable=True,
                facetable=True
            ),
            SimpleField(
                name="FeatureListingDisplayOrder",
                type=SearchFieldDataType.Int32,
                searchable=False,
                filterable=True,
                retrievable=True,
                stored=True,
                sortable=True,
                facetable=True
            ),
            SearchableField(
                name="SellerContactName",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="SellerCompanyName",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="ListingExpiration",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="PropertyType",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SimpleField(
                name="SquareFeet",
                type=SearchFieldDataType.String,
                searchable=False,
                filterable=True,
                retrievable=True,
                stored=True,
                sortable=True,
                facetable=True
            ),
            SearchableField(
                name="Units",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SimpleField(
                name="Occupancy",
                type=SearchFieldDataType.String,
                searchable=False,
                filterable=True,
                retrievable=True,
                stored=True,
                sortable=True,
                facetable=True
            ),
            SimpleField(
                name="YearBuilt",
                type=SearchFieldDataType.String,
                searchable=False,
                filterable=True,
                retrievable=True,
                stored=True,
                sortable=True,
                facetable=True
            ),
            SimpleField(
                name="YearRenovated",
                type=SearchFieldDataType.String,
                searchable=False,
                filterable=True,
                retrievable=True,
                stored=True,
                sortable=True,
                facetable=True
            ),
            SearchableField(
                name="CapitalInvested",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="BuildingClass",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="Building",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="Stories",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="FloorPlates",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="Elevators",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="ParkingRatio",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SimpleField(
                name="Acres",
                type=SearchFieldDataType.String,
                searchable=False,
                filterable=True,
                retrievable=True,
                stored=True,
                sortable=True,
                facetable=True
            ),
            SearchableField(
                name="Zoning",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="APN",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="Tenancy",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="LeaseType",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="OwnershipInterest",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SimpleField(
                name="AskingPrice",
                type=SearchFieldDataType.String,
                searchable=False,
                filterable=True,
                retrievable=True,
                stored=True,
                sortable=True,
                facetable=True
            ),
            SimpleField(
                name="IsUnpriced",
                type=SearchFieldDataType.Boolean,
                searchable=False,
                filterable=True,
                retrievable=True,
                stored=True,
                sortable=True,
                facetable=True
            ),
            SimpleField(
                name="PricePsf",
                type=SearchFieldDataType.String,
                searchable=False,
                filterable=True,
                retrievable=True,
                stored=True,
                sortable=True,
                facetable=True
            ),
            SimpleField(
                name="PriceUnit",
                type=SearchFieldDataType.String,
                searchable=False,
                filterable=True,
                retrievable=True,
                stored=True,
                sortable=True,
                facetable=True
            ),
            SimpleField(
                name="PriceAcre",
                type=SearchFieldDataType.String,
                searchable=False,
                filterable=True,
                retrievable=True,
                stored=True,
                sortable=True,
                facetable=True
            ),
            SearchableField(
                name="Walt",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="CapRate",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="NOI",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="InPlaceCapRate",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="InPlaceNOI",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="T12Caprate",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="T12Noi",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="InPlaceRents",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="MarketRents",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="RentsBelowMarket",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="MarktoMarketCapRate",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="Grm",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="PotentialGrm",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="InvestmentPeriod",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="UnLeveredIrr",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="leveredIRR",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="EquityMultiple",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="CashOnCash",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="ReturnOnCost",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SimpleField(
                name="DaysOnMarket",
                type=SearchFieldDataType.String,
                searchable=False,
                filterable=True,
                retrievable=True,
                stored=True,
                sortable=True,
                facetable=True
            ),
            SimpleField(
                name="ClosingCapRate",
                type=SearchFieldDataType.String,
                searchable=False,
                filterable=True,
                retrievable=True,
                stored=True,
                sortable=True,
                facetable=True
            ),
            SimpleField(
                name="SalesPrice",
                type=SearchFieldDataType.String,
                searchable=False,
                filterable=True,
                retrievable=True,
                stored=True,
                sortable=True,
                facetable=True
            ),
            SimpleField(
                name="SalePricePsf",
                type=SearchFieldDataType.String,
                searchable=False,
                filterable=True,
                retrievable=True,
                stored=True,
                sortable=True,
                facetable=True
            ),
            SimpleField(
                name="SpVsAp",
                type=SearchFieldDataType.String,
                searchable=False,
                filterable=True,
                retrievable=True,
                stored=True,
                sortable=True,
                facetable=True
            ),
            SearchableField(
                name="CloseSeller",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SimpleField(
                name="NumberOfTenants",
                type=SearchFieldDataType.String,
                searchable=False,
                filterable=True,
                retrievable=True,
                stored=True,
                sortable=True,
                facetable=True
            ),
            SearchableField(
                name="Zoning1",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="FeaturedImage",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="BannerImage",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="PropertyTeamUrl",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SimpleField(
                name="IsCARequired",
                type=SearchFieldDataType.Boolean,
                searchable=False,
                filterable=True,
                retrievable=True,
                stored=True,
                sortable=True,
                facetable=True
            ),
            SearchableField(
                name="PageCount",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="VisitorCount",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SimpleField(
                name="CASignedCount",
                type=SearchFieldDataType.String,
                searchable=False,
                filterable=True,
                retrievable=True,
                stored=True,
                sortable=True,
                facetable=True
            ),
            SimpleField(
                name="DownloadCount",
                type=SearchFieldDataType.String,
                searchable=False,
                filterable=True,
                retrievable=True,
                stored=True,
                sortable=True,
                facetable=True
            ),
            SimpleField(
                name="OfferCount",
                type=SearchFieldDataType.String,
                searchable=False,
                filterable=True,
                retrievable=True,
                stored=True,
                sortable=True,
                facetable=True
            ),
            SimpleField(
                name="DDRequestsCount",
                type=SearchFieldDataType.String,
                searchable=False,
                filterable=True,
                retrievable=True,
                stored=True,
                sortable=True,
                facetable=True
            ),
            SearchableField(
                name="PropertyDescription",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="MultiplePropertyImages",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="MultipleOMDocuments",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="MultipleDDDocuments",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="CADocument",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="OtherImages",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="PropertyListingType",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),

            # Complex collection - omddrelationship
            ComplexField(
                name="omddrelationship",
                collection=True,
                fields=[
                    SearchableField(
                        name="Name",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="UserId",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SimpleField(
                        name="IsCASigned",
                        type=SearchFieldDataType.Boolean,
                        searchable=False,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True
                    ),
                    SearchableField(
                        name="NDASignedDateTime",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="SecurityRole",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SimpleField(
                        name="IsOMApproved",
                        type=SearchFieldDataType.Boolean,
                        searchable=False,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True
                    ),
                    SimpleField(
                        name="IsOMRequested",
                        type=SearchFieldDataType.Boolean,
                        searchable=False,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True
                    ),
                    SimpleField(
                        name="IsOMRejected",
                        type=SearchFieldDataType.Boolean,
                        searchable=False,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True
                    ),
                    SimpleField(
                        name="HasOMDefaultAccess",
                        type=SearchFieldDataType.Boolean,
                        searchable=False,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True
                    ),
                    SearchableField(
                        name="OMStatus",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="OMRequestedDate",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="OMApprovedDate",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="OMApprovedBy",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="OMRejectedDate",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="OMRejectedBy",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SimpleField(
                        name="IsDDApproved",
                        type=SearchFieldDataType.Boolean,
                        searchable=False,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True
                    ),
                    SimpleField(
                        name="IsDDRequested",
                        type=SearchFieldDataType.Boolean,
                        searchable=False,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True
                    ),
                    SimpleField(
                        name="IsDDRejected",
                        type=SearchFieldDataType.Boolean,
                        searchable=False,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True
                    ),
                    SearchableField(
                        name="DDStatus",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="DuediligenceRequestDateTime",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="DuediligenceApprovedDateTime",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="DuediligenceApprovedBy",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="DuediligenceRejectDateTime",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="DuediligenceRejectBy",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                ]
            ),

            # Complex collection - property_document
            ComplexField(
                name="property_document",
                collection=True,
                fields=[
                    SearchableField(
                        name="DirectoryName",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="Type",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="PropertyDocument",
                        type=SearchFieldDataType.Collection(SearchFieldDataType.String),
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                ]
            ),

            # Complex collection - ConfidentialAgreement
            ComplexField(
                name="ConfidentialAgreement",
                collection=True,
                fields=[
                    SearchableField(
                        name="ConfidentialAgreementFile",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                ]
            ),

            # Complex collection - property_agent
            ComplexField(
                name="property_agent",
                collection=True,
                fields=[
                    SearchableField(
                        name="PropertyName",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="AgentId",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="Name",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SimpleField(
                        name="IsNotificationEnabled",
                        type=SearchFieldDataType.Boolean,
                        searchable=False,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True
                    ),
                ]
            ),

            # Complex collection - SuiteDetails
            ComplexField(
                name="SuiteDetails",
                collection=True,
                fields=[
                    SearchableField(
                        name="SuiteId",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="Suite",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="AskingPrice",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="Rsf",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="RateTimePeriod",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="MinimumDivisible",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="MaximumDivisible",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="ListingType",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="LeaseTerm",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="Parking",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="PropertyConditions",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SimpleField(
                        name="IsNegotiable",
                        type=SearchFieldDataType.Boolean,
                        searchable=False,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True
                    ),
                    SearchableField(
                        name="Comment",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="MultipleSuiteImages",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="MultipleFloorPlans",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="MultipleTourSpaces",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="SuiteLeaseType",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="SuiteSpaceSubType",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="LeasingHighlights",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                ]
            ),

            # Complex collection - property_assign_agent
            ComplexField(
                name="property_assign_agent",
                collection=True,
                fields=[
                    SearchableField(
                        name="PropertyName",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="AgentId",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="AgentName",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                ]
            ),

            # Complex collection - PropertyLeadNotes
            ComplexField(
                name="PropertyLeadNotes",
                collection=True,
                fields=[
                    SearchableField(
                        name="PropertyName",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="LeadId",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="LeadName",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="Note",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SimpleField(
                        name="IsNoteImportant",
                        type=SearchFieldDataType.Boolean,
                        searchable=False,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True
                    ),
                ]
            ),

            # Complex collection - PropertyLeadOffers
            ComplexField(
                name="PropertyLeadOffers",
                collection=True,
                fields=[
                    SearchableField(
                        name="OfferId",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="PurchasePrice",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="Deposit",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="AdditionalDeposit",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="DiligencePeriod",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="ClosingPeriod",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="SubmittedDate",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="UserId",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="LeadName",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="PropertyId",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="PropertyName",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="BrokerCommission",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        stored=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                ]
            ),
        ]

        # Create the index
        index = SearchIndex(
            name=settings.azure_property_index,
            fields=fields,
            vector_search=vector_search,
        )
        index_client.create_index(index)
        logger.info(f"Created index {settings.azure_property_index}")
    except Exception as e:
        logger.error(f"Error creating index: {str(e)}")
        raise


def create_user_records_index(force_recreate=False):
    """
    Create the user records index in Azure AI Search if it doesn't exist
    or recreate it if force_recreate is True

    Args:
        force_recreate: If True, delete the existing index and recreate it
    """
    try:
        index_client = get_search_index_client()
        user_index_name = settings.azure_user_index

        # Check if index exists
        if user_index_name in [index.name for index in index_client.list_indexes()]:
            if force_recreate:
                logger.info(f"Deleting existing index {user_index_name} to recreate it")
                index_client.delete_index(user_index_name)
            else:
                logger.info(f"Index {user_index_name} already exists")
                return

        # Define vector search configuration
        vector_search = VectorSearch(
            algorithms=[
                HnswAlgorithmConfiguration(
                    name="hnsw-config-users",
                    parameters={
                        "m": 4,
                        "efConstruction": 400,
                        "efSearch": 500,
                        "metric": "cosine",
                    },
                )
            ],
            profiles=[
                VectorSearchProfile(
                    name="embedding-profile-users",
                    algorithm_configuration_name="hnsw-config-users",
                )
            ],
        )

        # Define fields for the user index based on exact specifications
        fields = [
            # Key field - id (non-searchable, non-filterable, retrievable, stored, non-sortable, non-facetable, key=true)
            SimpleField(
                name="id",
                type=SearchFieldDataType.String,
                key=True,
                searchable=False,
                filterable=False,
                retrievable=True,
                sortable=False,
                facetable=False
            ),

            # Basic user fields with standard.lucene analyzer
            SearchableField(
                name="UserId",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="FirstName",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="LastName",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="CompanyId",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="CompanyName",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="CompanyUrl",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="ProfileImage",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="ConfigurationId",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="TeamName",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="TeamUrl",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="Title",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="IndustryRoleId",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="Role",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="InvestorTypeId",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="InvestorType",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="BrokerTypeId",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="BrokerType",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="Email",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="Bio",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="CorporateLicense",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="UserTypeId",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="UserType",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="Address",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="City",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="State",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="ZipCode",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="Country",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="WorkPhone",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="MobilePhone",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="SpaceNeed",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),

            # Complex field - Exchange1031 (Collection of complex type)
            ComplexField(
                name="Exchange1031",
                collection=True,
                fields=[
                    SearchableField(
                        name="ExchangeStatus",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="Name",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="Company",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="IndustryRole",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="ExchangeAmount",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="IdentificationExpiration",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="EquityAmount",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="DebtAmount",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="PreferredDealSize",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="PreferredPropertyType",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="PreferredMarkets",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="InvestmentStrategy",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="PreferredReturnMetrics",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="Source",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="LastUpdated",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                ]
            ),

            # Complex field - AcquisitionCriteriaUserRelation (Collection of complex type)
            ComplexField(
                name="AcquisitionCriteriaUserRelation",
                collection=True,
                fields=[
                    SearchableField(
                        name="UserId",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="LeadName",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="AcquisitionCriteriaTypeId",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="AcquisitionCriteriaType",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="AcquisitionCriteriaSubTypeId",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="AcquisitionCriteriaSubType",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                ]
            ),

            # Complex field - ContactActivities (Collection of complex type)
            ComplexField(
                name="ContactActivities",
                collection=True,
                fields=[
                    SearchableField(
                        name="ActivityName",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="Address",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="UserId",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="PropertyId",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="PropertyName",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="InsightName",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="InsightId",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="DocumentType",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="CreatedDate",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="SiteName",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="SiteURL",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="FilesCount",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                    SearchableField(
                        name="ListingOrInsightUrl",
                        type=SearchFieldDataType.String,
                        searchable=True,
                        filterable=True,
                        retrievable=True,
                        sortable=False,
                        facetable=True,
                        analyzer_name="standard.lucene"
                    ),
                ]
            ),

            # Additional top-level fields
            SearchableField(
                name="LeadName",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="AdditionalDetail",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="IsPinned",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
            SearchableField(
                name="UserTeamCategories",
                type=SearchFieldDataType.String,
                searchable=True,
                filterable=True,
                retrievable=True,
                sortable=True,
                facetable=True,
                analyzer_name="standard.lucene"
            ),
        ]

        # Create the index
        index = SearchIndex(
            name=user_index_name, fields=fields, vector_search=vector_search
        )
        index_client.create_index(index)
        logger.info(f"Created index {user_index_name}")
    except Exception as e:
        logger.error(f"Error creating user index: {str(e)}")
        raise


def create_property_documents_index(force_recreate=False):
    """
    Create the property documents index in Azure AI Search if it doesn't exist
    or recreate it if force_recreate is True. This index stores embedded chunks
    of property documents (PDFs, Word docs, etc.) with links back to properties.

    Args:
        force_recreate: If True, delete the existing index and recreate it
    """
    try:
        index_client = get_search_index_client()
        index_name = settings.azure_property_document_index

        # Check if index exists
        if index_name in [index.name for index in index_client.list_indexes()]:
            if force_recreate:
                logger.info(f"Deleting existing index {index_name} to recreate it")
                index_client.delete_index(index_name)
            else:
                logger.info(f"Index {index_name} already exists")
                return

        # Define vector search configuration
        vector_search = VectorSearch(
            algorithms=[
                HnswAlgorithmConfiguration(
                    name="hnsw-config",
                    parameters={
                        "m": 4,
                        "efConstruction": 400,
                        "efSearch": 500,
                        "metric": "cosine",
                    },
                )
            ],
            profiles=[
                VectorSearchProfile(
                    name="embedding-profile",
                    algorithm_configuration_name="hnsw-config",
                )
            ],
        )

        # Define fields for the property documents index
        # ID is now the document URL (with chunk suffix for chunks)
        fields = [
            SimpleField(name="id", type=SearchFieldDataType.String, key=True, filterable=True),
            SearchableField(name="document_url", type=SearchFieldDataType.String, filterable=True),
            SimpleField(name="property_id", type=SearchFieldDataType.String, filterable=True),
            SearchableField(name="property_name", type=SearchFieldDataType.String, filterable=True),
            SearchableField(name="document_type", type=SearchFieldDataType.String, filterable=True),
            SearchableField(name="document_name", type=SearchFieldDataType.String, filterable=True),
            SearchableField(name="chunk_text", type=SearchFieldDataType.String, filterable=True),
            SimpleField(name="chunk_index", type=SearchFieldDataType.Int32, filterable=True),
            SimpleField(name="total_chunks", type=SearchFieldDataType.Int32, filterable=True),
            SearchableField(name="file_extension", type=SearchFieldDataType.String, filterable=True),
            SimpleField(name="created_date", type=SearchFieldDataType.DateTimeOffset, filterable=True),
            SimpleField(name="team_id", type=SearchFieldDataType.String, filterable=True),
            SearchableField(name="subscription_name", type=SearchFieldDataType.String, filterable=True),
            SearchField(
                name="embeddings",
                type=SearchFieldDataType.Collection(SearchFieldDataType.Single),
                vector_search_dimensions=1536,  # OpenAI embeddings dimension
                vector_search_profile_name="embedding-profile",
            ),
        ]

        # Create the index
        index = SearchIndex(name=index_name, fields=fields, vector_search=vector_search)
        index_client.create_index(index)
        logger.info(f"Created property documents index {index_name}")
    except Exception as e:
        logger.error(f"Error creating property documents index: {str(e)}")
        raise


def create_property_simple_index(force_recreate=False):
    """
    Create a simplified property index with minimal fields to avoid type conversion issues

    Args:
        force_recreate: If True, delete the existing index and recreate it
    """
    try:
        index_client = get_search_index_client()
        index_name = settings.azure_property_document_index

        # Check if index exists
        if index_name in [index.name for index in index_client.list_indexes()]:
            if force_recreate:
                logger.info(f"Deleting existing index {index_name} to recreate it")
                index_client.delete_index(index_name)
            else:
                logger.info(f"Index {index_name} already exists")
                return

        # Define vector search configuration
        vector_search = VectorSearch(
            algorithms=[
                HnswAlgorithmConfiguration(
                    name="hnsw-config-simple",
                    parameters={
                        "m": 4,
                        "efConstruction": 400,
                        "efSearch": 500,
                        "metric": "cosine",
                    },
                )
            ],
            profiles=[
                VectorSearchProfile(
                    name="embedding-profile-simple",
                    algorithm_configuration_name="hnsw-config-simple",
                )
            ],
        )

        # Minimal fields - just what we need for search
        fields = [
            SimpleField(name="id", type=SearchFieldDataType.String, key=True),
            SearchableField(name="content", type=SearchFieldDataType.String),
            SearchableField(name="raw_data", type=SearchFieldDataType.String),
            SearchField(
                name="embeddings",
                type=SearchFieldDataType.Collection(SearchFieldDataType.Single),
                vector_search_dimensions=1536,
                vector_search_profile_name="embedding-profile-simple",
            ),
        ]

        # Create the index
        index = SearchIndex(name=index_name, fields=fields, vector_search=vector_search)
        index_client.create_index(index)
        logger.info(f"Created simplified property index {index_name}")
    except Exception as e:
        logger.error(f"Error creating simplified property index: {str(e)}")
        raise


def create_user_simple_index(force_recreate=False):
    """
    Create a simplified user index with minimal fields to avoid type conversion issues

    Args:
        force_recreate: If True, delete the existing index and recreate it
    """
    try:
        index_client = get_search_index_client()
        index_name = settings.azure_user_index

        # Check if index exists
        if index_name in [index.name for index in index_client.list_indexes()]:
            if force_recreate:
                logger.info(f"Deleting existing index {index_name} to recreate it")
                index_client.delete_index(index_name)
            else:
                logger.info(f"Index {index_name} already exists")
                return

        # Define vector search configuration
        vector_search = VectorSearch(
            algorithms=[
                HnswAlgorithmConfiguration(
                    name="hnsw-config-userdata",
                    parameters={
                        "m": 4,
                        "efConstruction": 400,
                        "efSearch": 500,
                        "metric": "cosine",
                    },
                )
            ],
            profiles=[
                VectorSearchProfile(
                    name="embedding-profile-userdata",
                    algorithm_configuration_name="hnsw-config-userdata",
                )
            ],
        )

        # Minimal fields - just what we need for search
        fields = [
            SimpleField(name="id", type=SearchFieldDataType.String, key=True),
            SearchableField(name="content", type=SearchFieldDataType.String, filterable=True),
            SearchableField(name="raw_data", type=SearchFieldDataType.String, filterable=True),
            SearchField(
                name="embeddings",
                type=SearchFieldDataType.Collection(SearchFieldDataType.Single),
                vector_search_dimensions=1536,
                vector_search_profile_name="embedding-profile-userdata",
            ),
        ]

        # Create the index
        index = SearchIndex(name=index_name, fields=fields, vector_search=vector_search)
        index_client.create_index(index)
        logger.info(f"Created simplified user index {index_name}")
    except Exception as e:
        logger.error(f"Error creating simplified user index: {str(e)}")
        raise
